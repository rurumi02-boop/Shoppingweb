{% extends "base.html" %}
{% load static %}

{% block title %}
<title>çµå¸³ - æ´¾æ£®Pythonéœ²ç‡Ÿç”¨å“å•†åŸ</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<style>
    body {
        background-color: #f8f9fa;
    }
    .form-section {
        background: #fff;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .section-title {
        border-left: 5px solid #0d6efd;
        padding-left: 10px;
        margin-bottom: 20px;
        font-weight: 600;
    }
    @media (max-width: 576px) {
        .section-title {
            font-size: 1.1rem;
            padding-left: 6px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="mb-4 text-center">ğŸ§¾ è¨‚å–®å…§å®¹</h2>

    <!-- è³¼ç‰©æ¸…å–® -->
    <div class="form-section mb-5">
        <div class="section-title">ğŸ›ï¸ è³¼ç‰©æ¸…å–®</div>
        <table class="table table-striped align-middle">
            <thead class="table-light">
                <tr>
                    <th>å•†å“åç¨±</th>
                    <th>å–®åƒ¹</th>
                    <th>æ•¸é‡</th>
                    <th>å°è¨ˆ</th>
                </tr>
            </thead>
            <tbody>
                {% for product_id, item in cart_items.items %}
                <tr>
                    <td>{{ item.product_name }}</td>
                    <td>${{ item.price }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ item.subtotal }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <p class="fs-5 text-end"><strong>ç¸½é‡‘é¡ï¼š${{ total }}</strong></p>
    </div>

    <!-- çµå¸³è¡¨å–® -->
    <div class="form-section">
        <form method="post" action="{% url 'submit_order' %}">
            {% csrf_token %}
            <div class="section-title">ğŸ“¦ å¯„é€è³‡è¨Š</div>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="recipient_name" class="form-label">æ”¶ä»¶äººå§“å <span class="text-danger">*</span></label>
                    <input type="text" id="recipient_name" name="recipient_name" class="form-control"
                           placeholder="ä¾‹ï¼šç‹å°æ˜" required autocomplete="name" />
                </div>

                <div class="col-md-6">
                    <label for="phone" class="form-label">è¯çµ¡é›»è©± <span class="text-danger">*</span></label>
                    <input type="tel" id="phone" name="contact_phone" class="form-control"
                           placeholder="ä¾‹ï¼š0912345678" required maxlength="10"
                           pattern="^09[0-9]{8}$"
                           title="è«‹è¼¸å…¥æ­£ç¢ºçš„å°ç£æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ï¼Œä¾‹å¦‚ï¼š0912345678"
                           autocomplete="tel" />
                </div>

                <div class="col-12">
                    <label for="address" class="form-label">è¡—é“åœ°å€ <span class="text-danger">*</span></label>
                    <input type="text" id="address" name="shipping_address" class="form-control"
                           placeholder="ä¾‹ï¼šä¿¡ç¾©å€æ¾å£½è·¯ 20 è™Ÿ" required autocomplete="street-address" />
                </div>

                <div class="col-md-6">
                    <label for="zip" class="form-label">éƒµéå€è™Ÿ</label>
                    <input type="text" id="zip" name="shipping_zip_code" class="form-control"
                           placeholder="ä¾‹ï¼š110" maxlength="5" autocomplete="postal-code" />
                </div>
            </div>

            <!-- ä»˜æ¬¾æ–¹å¼ -->
            <div class="section-title mt-4">ğŸ’³ ä»˜æ¬¾æ–¹å¼</div>
            <div class="row align-items-center mb-4">
                <div class="col-sm-9">
                    <select id="payment_method" name="payment_method" class="form-select" required>
                        <option value="">è«‹é¸æ“‡</option>
                        <option value="ä¿¡ç”¨å¡">ä¿¡ç”¨å¡</option>
                        <option value="è²¨åˆ°ä»˜æ¬¾">è²¨åˆ°ä»˜æ¬¾</option>
                        <option value="LINE Pay">LINE Pay</option>
                    </select>
                </div>
            </div>

            <!-- âœ… æäº¤æŒ‰éˆ•å€ -->
            <div class="text-end mt-4">
                <button type="submit" class="btn btn-success me-2">âœ… æäº¤è¨‚å–®</button>
                <a href="{% url 'view_cart' %}" class="btn btn-secondary">è¿”å›è³¼ç‰©è»Š</a>
            </div>

            {% if not user.is_authenticated %}
            <div class="alert alert-warning text-center mt-4">
                è«‹å…ˆ<a href="{% url 'userlogin' %}?next={{ request.path }}">ç™»å…¥</a> æˆ– <a href="{% url 'register' %}">è¨»å†Š</a> æ‰èƒ½çµå¸³
            </div>
            {% endif %}
        </form>
    </div>
</div>
{% endblock %}

