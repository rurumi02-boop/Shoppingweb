{% extends "base.html" %}

{% load static %}
{% load custom_filters %}

{% block title %}<title>皮蝦購物商城 - 首頁</title>{% endblock %}

{% block styles %}
<style>
  /* 蝦皮風格首頁 */
  .shopee-header {
    background: linear-gradient(180deg, #ee4d2d 0%, #ff7337 100%);
    padding: 20px 0;
    color: white;
  }
  
  .shopee-search-bar {
    background: white;
    border-radius: 4px;
    padding: 8px 15px;
    display: flex;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .shopee-search-bar input {
    border: none;
    outline: none;
    flex: 1;
    font-size: 14px;
  }
  
  .shopee-search-bar button {
    background: #ee4d2d;
    border: none;
    color: white;
    padding: 8px 20px;
    border-radius: 4px;
    cursor: pointer;
  }
  
  .category-banner {
    background: white;
    margin: 20px 0;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .category-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    border-bottom: 2px solid #ee4d2d;
  }
  
  .category-tab {
    padding: 12px 20px;
    background: white;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    color: #666;
    transition: all 0.3s;
  }
  
  .category-tab:hover {
    color: #ee4d2d;
  }
  
  .category-tab.active {
    color: #ee4d2d;
    border-bottom-color: #ee4d2d;
    font-weight: 600;
  }
  
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    padding: 20px 0;
  }
  
  .product-card {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: pointer;
  }
  
  .product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  
  .product-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    background: #f5f5f5;
  }
  
  .product-card-body {
    padding: 15px;
  }
  
  .product-card-title {
    font-size: 14px;
    color: #333;
    margin-bottom: 8px;
    line-height: 1.4;
    height: 40px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  
  .product-card-price {
    color: #ee4d2d;
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
  }
  
  .product-card-actions {
    display: flex;
    gap: 8px;
  }
  
  .btn-shopee {
    background: #ee4d2d;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.3s;
    flex: 1;
  }
  
  .btn-shopee:hover {
    background: #d73211;
  }
  
  .btn-outline-shopee {
    background: white;
    color: #ee4d2d;
    border: 1px solid #ee4d2d;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
    flex: 1;
  }
  
  .btn-outline-shopee:hover {
    background: #ee4d2d;
    color: white;
  }
  
  .carousel-container {
    margin-bottom: 30px;
  }
  
  .welcome-section {
    text-align: center;
    padding: 30px 0;
    background: linear-gradient(135deg, #ee4d2d 0%, #ff7337 100%);
    color: white;
    margin-bottom: 30px;
  }
  
  .welcome-section h1 {
    font-size: 36px;
    font-weight: 700;
    margin-bottom: 10px;
  }
  
  .welcome-section p {
    font-size: 18px;
    opacity: 0.9;
  }
  
  @media (max-width: 768px) {
    .product-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    
    .category-tabs {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    .category-tab {
      white-space: nowrap;
      font-size: 14px;
      padding: 10px 15px;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- 歡迎區塊 -->
<div class="welcome-section">
  <h1>歡迎來到皮蝦購物商城</h1>
  <p>探索最適合你的商品</p>
</div>

<!-- 輪播圖片 -->
<div class="carousel-container">
  <div><img src="{% static 'myapp/images/campingLife7.jpg' %}" alt="banner1"></div>
  <div><img src="{% static 'myapp/images/campingLife2.jpg' %}" alt="banner2"></div>
  <div><img src="{% static 'myapp/images/campingLife3.jpg' %}" alt="banner3"></div>
  <div><img src="{% static 'myapp/images/campingLife4.jpg' %}" alt="banner4"></div>
  <div><img src="{% static 'myapp/images/campingLife5.jpg' %}" alt="banner5"></div>
  <div><img src="{% static 'myapp/images/campingLife6.jpg' %}" alt="banner6"></div>
</div>

<div class="container mt-4">
  <!-- 分類標籤 -->
  <div class="category-banner">
    <div class="category-tabs" id="categoryTabs">
      {% for name, cat_id in categories %}
      <button class="category-tab {% if forloop.first %}active{% endif %}" 
              data-tab="tab{{ cat_id }}" 
              onclick="switchCategory('tab{{ cat_id }}')">
        {{ name }}
      </button>
      {% endfor %}
    </div>

    <!-- 手機版下拉選單 -->
    <div class="d-block d-md-none mb-3">
      <select class="form-select" id="categorySelect" onchange="switchTab(this)">
        {% for name, cat_id in categories %}
        <option value="tab{{ cat_id }}">{{ name }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Tab 分類內容 -->
    <div class="tab-content mt-3" id="myTabContent">
      {% for name, cat_id in categories %}
      <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="tab{{ cat_id }}">
        <div class="product-grid">
          {% with category_products|get_item:cat_id as products %}
            {% for product in products %}
            <div class="product-card">
              <a href="{% url 'product_detail' product.product_id %}">
                <img src="{{ product.image_url|default:'https://via.placeholder.com/200x200?text=No+Image' }}" 
                     alt="{{ product.product_name }}">
              </a>
              <div class="product-card-body">
                <a href="{% url 'product_detail' product.product_id %}" style="text-decoration: none; color: inherit;">
                  <h3 class="product-card-title">{{ product.product_name }}</h3>
                </a>
                <div class="product-card-price">${{ product.price|floatformat:0 }}</div>
                <div class="product-card-actions">
                  <a href="{% url 'product_detail' product.product_id %}" class="btn-outline-shopee" style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
                    查看詳情
                  </a>
                  <form method="post" action="{% url 'add_to_cart' product.product_id %}" style="margin: 0; flex: 1;">
                    {% csrf_token %}
                    <button type="submit" class="btn-shopee w-100">
                      加入購物車
                    </button>
                  </form>
                </div>
              </div>
            </div>
            {% empty %}
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #999;">
              <p>此分類暫無商品。</p>
            </div>
            {% endfor %}
          {% endwith %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
<br>
{% endblock %}

{% block script %}
<script>
// 切換分類標籤
function switchCategory(tabId) {
  // 移除所有 active 狀態
  document.querySelectorAll('.category-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  document.querySelectorAll('.tab-pane').forEach(pane => {
    pane.classList.remove('show', 'active');
  });
  
  // 添加 active 狀態
  event.target.classList.add('active');
  const targetPane = document.getElementById(tabId);
  if (targetPane) {
    targetPane.classList.add('show', 'active');
  }
  
  // 更新手機版下拉選單
  const select = document.getElementById('categorySelect');
  if (select) select.value = tabId;
}

// 手機版下拉選單切換 Tab
function switchTab(select) {
  var tabId = select.value;
  
  // 移除所有 active 狀態
  document.querySelectorAll('.category-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  document.querySelectorAll('.tab-pane').forEach(pane => {
    pane.classList.remove('show', 'active');
  });
  
  // 添加 active 狀態
  const targetTab = document.querySelector(`[data-tab="${tabId}"]`);
  if (targetTab) targetTab.classList.add('active');
  
  const targetPane = document.getElementById(tabId);
  if (targetPane) {
    targetPane.classList.add('show', 'active');
  }
}
</script>
{% endblock %}
